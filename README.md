# Learn Zod

**Quick Links:**

- Website: https://zod.dev/
- Primitives: https://zod.dev/?id=primitives
- Used in my project:
	- [learn-svelte/new-ai-sdk/src/routes/api/chat/tools.ts](https://github.com/sahilrajput03/learn-svelte/blob/ac62d5c78b5ad40759d535259b54788f0f87f9d4/new-ai-sdk/src/routes/api/chat/tools.ts)
	- [qr-solution-backend](https://github.com/sahilrajput03/qr-solution-backend)


## Code (autogenerated by auto-docs)

### File - `1.ts`

<!-- MARKDOWN-AUTO-DOCS:START (CODE:src=./1.ts) -->
<!-- The below code snippet is automatically added from ./1.ts -->
```ts
import { z } from "zod";
// * primitive types
//  z.string()
//  z.number()
//  z.bigint();
//  z.boolean();
//  z.symbol();
//  z.undefined();
//  z.null();
// * More
//  z.array()
//  z.string().datetime(),
//  z.string().regex(SIMPLE_MONGODB_ID_REGEX),
//  z.string().datetime().optional(), // Making anything optional

// Creating a schema for strings
const nameSchema = z.string();
// Learn: Customizing errors (https://zod.dev/error-customization)
//        1. We can provide custome error message via and it will be returned in `error.issues[*].message` property:
// const nameSchema = z.string("Please provide string type only.");
//        2. Another way to pass custom error message is via passing an object:
// const nameSchema = z.string({ error: "Please provide string type only." });
//        3. Passing an object allows us to pass function:
// const nameSchema = z.string({
//     error: (issue) => {
//         const { code, input, expected } = issue
//         console.log('issue?', Object.assign({}, { code, input, expected }))
//         // issue.code; // the issue code
//         // issue.input; // the input data
//         // issue.inst; // (*very long object*) the schema/check that originated this issue
//         // issue.path; // the path of the error
//         return "Please provide string type only. " + new Date().toString();
//     }
// });
// parsing
console.log(nameSchema.parse("tuna")); // "tuna"
// console.log(nameSchema.parse(12)); // throws ZodError

// Using `safeParse` zod doesn't throw error when validation fails
console.log(nameSchema.safeParse("tuna")); // { success: true; data: "tuna" }
// console.log(nameSchema.safeParse(12)); // { success: false; error: `ZodError instance` }
const result1 = nameSchema.safeParse(12)
if (!result1.success) {
    console.log("‚ùå ~ result1.error.issues:", result1.error.issues)
    /**
    [
        {
            expected: 'string',
            code: 'invalid_type',
            path: [],
            message: 'Invalid input: expected string, received number'
        }
    ]
     */
}


// User
console.log('\nUser üöÄ')
const User = z.object({
    username: z.string(),
    phone: z.number(),
});
console.log(User.parse({ username: "Ludwig", phone: 1234 })); // { username: 'Ludwig', phone: 1234 }

const result2 = User.safeParse({ username: 42, phone: "100" });
if (!result2.success) {
    // console.log("‚ùå ~ result2:", result2.error) // `ZodError instance`
    console.log("‚ùå ~ result2.error.issues:", result2.error.issues)
    /**
    [
        {
            expected: 'string',
            code: 'invalid_type',
            path: [ 'username' ],
            message: 'Invalid input: expected string, received number'
        },
        {
            expected: 'number',
            code: 'invalid_type',
            path: [ 'phone' ],
            message: 'Invalid input: expected number, received string'
        }
    ]
     */

    // console.log(z.prettifyError(result.error))
    /**
        ‚úñ Invalid input: expected string, received number
          ‚Üí at username
        ‚úñ Invalid input: expected number, received string
          ‚Üí at phone
     */
} else {
    result2.data;
}

// ‚úÖ Extract the inferred type
type User = z.infer<typeof User>;


// Create new schema with all fields optional
const UserPartial = User.partial();


// ‚ù§Ô∏è Accessing a nested schema
const CarSchema = z.object({ name: z.string(), price: z.number() });
console.log(CarSchema.shape.name.parse("BMW")) // "BMW"


//  TODO ‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è : https://www.youtube.com/watch?v=9UVPk0Ulm6U
```
<!-- MARKDOWN-AUTO-DOCS:END -->

### File - `2.ts`

<!-- MARKDOWN-AUTO-DOCS:START (CODE:src=./2.ts) -->
<!-- The below code snippet is automatically added from ./2.ts -->
```ts
import { z } from "zod";

const SIMPLE_MONGODB_ID_REGEX = /^[a-f\d]{24}$/i;

// From Piyush's Project

// Job
const Job = z.object({
	order: z.string().regex(SIMPLE_MONGODB_ID_REGEX),
	images: z.array(z.object({
		public_id: z.string(),
		url: z.string(),
	})),
	itemName: z.string(),
	costPerUnit: z.number(),
	inventory: z.null(),
	quantity: z.number(),
});
Job.parse({
	order: '5c9cb7138a874f1dcd0d8dcc',
	images: [{
		public_id: 'abc',
		url: 'abc',
	}],
	itemName: 'abc',
	costPerUnit: 0,
	inventory: null,
	quantity: 0,
});
type JobType = z.infer<typeof Job>;


// JobTask
const JobTask = z.object({
	order: z.string().regex(SIMPLE_MONGODB_ID_REGEX),
	job: z.string().regex(SIMPLE_MONGODB_ID_REGEX),
	jobTaskType: z.number(),
	status: z.number(),
	type: z.string(),
	notes: z.string(),
	user: z.string().regex(SIMPLE_MONGODB_ID_REGEX),
	// `deadline` is optional here because we may want to set this on backend instead of getting from frontend.
	deadline: z.string().datetime().optional(),
});
JobTask.parse({
	order: '5c9cb7138a874f1dcd0d8dcc',
	job: '5c9cb7138a874f1dcd0d8dcc',
	jobTaskType: 0,
	status: 0,
	type: 'abc',
	notes: 'abc',
	user: '5c9cb7138a874f1dcd0d8dcc',
	deadline: '2023-11-15T13:40:18.365Z',
});
type JobTaskType = z.infer<typeof JobTask>;


// Order
const Order = z.object({
	user: z.string().regex(SIMPLE_MONGODB_ID_REGEX),
	paymentInfo: z.object({
		subTotal: z.number(),
		discount: z.number(),
		tax: z.number(),
		totalAmount: z.number(),
		paidAmount: z.number(),
		remainingAmount: z.number(),
	}),
	note: z.string(),
	customer: z.string().regex(SIMPLE_MONGODB_ID_REGEX),
	shippingInfo: z.object({
		name: z.string(),
		phoneNumber: z.number(),
		deadline: z.string().datetime(),
		address: z.string(),
		instructions: z.string(),
	})
});
Order.parse({
	user: '5c9cb7138a874f1dcd0d8dcc',
	paymentInfo: {
		subTotal: 0,
		discount: 0,
		tax: 0,
		totalAmount: 0,
		paidAmount: 0,
		remainingAmount: 0,
	},
	note: 'abc',
	customer: '5c9cb7138a874f1dcd0d8dcc',
	shippingInfo: {
		name: 'abc',
		phoneNumber: 0,
		deadline: '2023-11-15T13:40:18.365Z',
		address: 'abc',
		instructions: 'abc',
	}
});
type OrderType = z.infer<typeof Order>;
```
<!-- MARKDOWN-AUTO-DOCS:END -->
